# 지속적 학습 실행 가이드

**작성일**: 2025-10-23
**목적**: 터미널 종료 후에도 학습이 계속 진행되도록 설정

---

## 📋 개요

학습이 장시간 소요될 때, 터미널을 종료하거나 SSH 연결이 끊어져도 학습이 계속 진행되도록 하는 방법들을 소개합니다.

---

## 🔧 방법 1: nohup 사용 (추천) ⭐

### 개요
- **장점**: 가장 간단하고 범용적
- **작동 원리**: 터미널 종료 신호(SIGHUP)를 무시하고 백그라운드 실행
- **로그**: 파일로 자동 저장

### 사용법

#### Bash / Git Bash (Windows)
```bash
# 기본 사용법
nohup python scripts/train.py \
    --data "E:/namwon_ai/dataset_silage_bale_rgb/dataset.yaml" \
    --model n \
    --epochs 150 \
    --batch 8 \
    --imgsz 1024 \
    --lr0 0.001 \
    --optimizer AdamW \
    --patience 100 \
    --name silage_optimized \
    > logs/train.log 2>&1 &

# 프로세스 ID 확인 (마지막 줄에 표시됨)
# 예: [1] 12345

# 진행 상황 확인
tail -f logs/train.log

# 프로세스 확인
ps aux | grep train.py

# 중단
kill 12345
# 또는
pkill -f train.py
```

#### 헬퍼 스크립트 사용 (더 편리함)
```bash
# Linux/Mac/Git Bash
bash scripts/run_training_persistent.sh

# Windows CMD
scripts\run_training_persistent.bat
```

---

## 🔧 방법 2: screen 사용 (세션 관리)

### 개요
- **장점**: 세션을 관리하고 언제든 다시 접속 가능
- **작동 원리**: 가상 터미널 세션 생성
- **추천 대상**: SSH 사용자, 여러 작업 동시 관리

### 설치

```bash
# Ubuntu/Debian
sudo apt-get install screen

# CentOS/RHEL
sudo yum install screen

# macOS (보통 기본 설치됨)
brew install screen

# Windows Git Bash (지원 안됨 - WSL 사용 권장)
```

### 사용법

```bash
# 1. 새 screen 세션 생성
screen -S yolo_training

# 2. 학습 실행
python scripts/train.py \
    --data "E:/namwon_ai/dataset_silage_bale_rgb/dataset.yaml" \
    --model n \
    --epochs 150 \
    --batch 8 \
    --imgsz 1024 \
    --lr0 0.001 \
    --optimizer AdamW \
    --patience 100 \
    --name silage_optimized

# 3. 세션에서 detach (학습은 계속 진행)
# Ctrl+A, D 누르기

# 4. 세션 목록 확인
screen -ls
# 출력 예:
# There is a screen on:
#     12345.yolo_training  (Detached)

# 5. 세션에 다시 접속
screen -r yolo_training

# 6. 세션 종료 (학습도 중단)
# 세션 안에서
exit
# 또는 Ctrl+D

# 7. 세션 강제 종료 (외부에서)
screen -X -S yolo_training quit
```

### 유용한 단축키

| 키 조합 | 기능 |
|---------|------|
| `Ctrl+A, D` | Detach (세션 유지하며 빠져나옴) |
| `Ctrl+A, K` | 세션 종료 (확인 후) |
| `Ctrl+A, [` | 스크롤 모드 (q로 종료) |
| `Ctrl+A, C` | 새 윈도우 생성 |
| `Ctrl+A, N` | 다음 윈도우 |
| `Ctrl+A, P` | 이전 윈도우 |

---

## 🔧 방법 3: tmux 사용 (고급 세션 관리)

### 개요
- **장점**: screen보다 강력하고 현대적
- **작동 원리**: 터미널 멀티플렉서
- **추천 대상**: 여러 창을 동시에 관리

### 설치

```bash
# Ubuntu/Debian
sudo apt-get install tmux

# CentOS/RHEL
sudo yum install tmux

# macOS
brew install tmux

# Windows Git Bash (지원 안됨 - WSL 사용 권장)
```

### 사용법

```bash
# 1. 새 tmux 세션 생성
tmux new -s yolo_training

# 2. 학습 실행
python scripts/train.py \
    --data "E:/namwon_ai/dataset_silage_bale_rgb/dataset.yaml" \
    --model n \
    --epochs 150 \
    --batch 8 \
    --imgsz 1024 \
    --lr0 0.001 \
    --optimizer AdamW \
    --patience 100 \
    --name silage_optimized

# 3. 세션에서 detach
# Ctrl+B, D

# 4. 세션 목록 확인
tmux ls
# 출력 예:
# yolo_training: 1 windows (created Mon Oct 23 14:30:00 2023)

# 5. 세션에 다시 접속
tmux attach -t yolo_training

# 6. 세션 종료
# 세션 안에서
exit
# 또는 Ctrl+D

# 7. 세션 강제 종료 (외부에서)
tmux kill-session -t yolo_training
```

### 유용한 단축키

| 키 조합 | 기능 |
|---------|------|
| `Ctrl+B, D` | Detach |
| `Ctrl+B, C` | 새 창 생성 |
| `Ctrl+B, N` | 다음 창 |
| `Ctrl+B, P` | 이전 창 |
| `Ctrl+B, %` | 수평 분할 |
| `Ctrl+B, "` | 수직 분할 |
| `Ctrl+B, ↑↓←→` | 패널 이동 |

---

## 🔧 방법 4: Windows 작업 스케줄러 (Windows 전용)

### 개요
- **장점**: Windows 재부팅 후에도 자동 실행 가능
- **작동 원리**: Windows 서비스로 등록
- **추천 대상**: Windows 서버 사용자

### 사용법

1. **작업 스케줄러 열기**
   ```
   시작 메뉴 → "작업 스케줄러" 검색
   ```

2. **기본 작업 만들기**
   - 이름: "YOLOv11 Training"
   - 트리거: "컴퓨터를 시작할 때" 또는 "로그온할 때"
   - 작업: "프로그램 시작"

3. **프로그램 설정**
   - 프로그램/스크립트: `python`
   - 인수 추가:
     ```
     scripts/train.py --data "E:/namwon_ai/dataset_silage_bale_rgb/dataset.yaml" --model n --epochs 150 --batch 8 --imgsz 1024 --lr0 0.001 --optimizer AdamW --patience 100 --name silage_optimized
     ```
   - 시작 위치: `C:\Users\LX\dbwjdakrso4235-sys`

4. **고급 설정**
   - "프로그램이 이미 실행 중인 경우": "기존 인스턴스 중지"
   - "사용 권한": "사용자의 로그온 여부에 관계없이 실행"

---

## 📊 방법 비교

| 방법 | 난이도 | 재접속 | 로그 | Windows | Linux/Mac | 추천도 |
|------|--------|--------|------|---------|-----------|--------|
| **nohup** | ⭐ 쉬움 | ❌ | ✅ | ✅ | ✅ | ⭐⭐⭐ |
| **screen** | ⭐⭐ 보통 | ✅ | ✅ | ❌ | ✅ | ⭐⭐⭐ |
| **tmux** | ⭐⭐⭐ 어려움 | ✅ | ✅ | ❌ | ✅ | ⭐⭐ |
| **작업 스케줄러** | ⭐⭐ 보통 | ❌ | ⚠️ | ✅ | ❌ | ⭐ |

### 추천 시나리오

| 상황 | 추천 방법 |
|------|----------|
| **빠르게 시작** | nohup |
| **SSH 원격 작업** | screen 또는 tmux |
| **여러 작업 관리** | tmux |
| **Windows 로컬** | nohup (Git Bash) |
| **Windows 서버** | 작업 스케줄러 |

---

## 🛠️ 실전 예제

### 예제 1: nohup으로 학습 시작하고 로그 확인

```bash
# 1. 학습 시작
nohup python scripts/train.py \
    --data "E:/namwon_ai/dataset_silage_bale_rgb/dataset.yaml" \
    --model n \
    --epochs 150 \
    --batch 8 \
    --imgsz 1024 \
    --lr0 0.001 \
    --optimizer AdamW \
    --patience 100 \
    --name silage_optimized \
    > logs/train_$(date +%Y%m%d_%H%M%S).log 2>&1 &

echo "프로세스 ID: $!"

# 2. 잠시 후 진행 상황 확인
tail -n 50 logs/train_*.log

# 3. 실시간 모니터링
tail -f logs/train_*.log

# 4. 특정 줄만 필터링 (예: Epoch 정보)
tail -f logs/train_*.log | grep "Epoch"

# 5. mAP 변화 추적
tail -f logs/train_*.log | grep "mAP50"
```

### 예제 2: screen으로 학습 + TensorBoard 동시 실행

```bash
# 1. screen 세션 생성
screen -S yolo_training

# 2. 학습 시작 (첫 번째 창)
python scripts/train.py --data ... --name silage_optimized

# 3. 새 창 생성 (Ctrl+A, C)
# 4. TensorBoard 시작 (두 번째 창)
tensorboard --logdir runs/segment

# 5. 창 전환 (Ctrl+A, N / Ctrl+A, P)
# 6. Detach (Ctrl+A, D)

# 7. 나중에 다시 접속
screen -r yolo_training

# 8. 창 전환하며 확인
# Ctrl+A, N (다음 창)
# Ctrl+A, P (이전 창)
```

### 예제 3: tmux로 분할 화면 모니터링

```bash
# 1. tmux 세션 생성
tmux new -s yolo_training

# 2. 화면 수직 분할 (Ctrl+B, ")
# 3. 위쪽 패널: 학습 실행
python scripts/train.py --data ... --name silage_optimized

# 4. 아래쪽 패널로 이동 (Ctrl+B, ↓)
# 5. 로그 실시간 확인
watch -n 1 'tail -20 runs/segment/silage_optimized/results.csv'

# 6. 다시 분할 (Ctrl+B, %)
# 7. GPU 사용량 모니터링
watch -n 1 nvidia-smi

# 8. Detach (Ctrl+B, D)
```

---

## 🔍 문제 해결

### 학습이 백그라운드에서 실행 중인지 확인

```bash
# 방법 1: ps 명령어
ps aux | grep train.py

# 방법 2: pgrep
pgrep -f train.py

# 방법 3: GPU 사용 확인
nvidia-smi
```

### 백그라운드 프로세스 중단

```bash
# 방법 1: kill (프로세스 ID 필요)
kill 12345

# 방법 2: pkill (이름으로 찾기)
pkill -f train.py

# 방법 3: killall (같은 이름 모두 종료)
killall python

# 방법 4: 강제 종료 (주의!)
kill -9 12345
```

### 로그 파일이 너무 클 때

```bash
# 최근 100줄만 확인
tail -n 100 logs/train.log

# 특정 패턴만 추출
grep "Epoch" logs/train.log > logs/epochs.log

# 로그 크기 확인
du -h logs/train.log

# 로그 압축 (진행 중이 아닐 때)
gzip logs/train.log
```

### nohup.out 파일 자동 생성 방지

```bash
# nohup 기본 동작: nohup.out 생성
# 해결: 명시적으로 리다이렉트
nohup python script.py > my.log 2>&1 &
```

---

## 📝 모범 사례

### 1. 항상 로그 저장
```bash
# ❌ 나쁜 예
nohup python script.py &

# ✅ 좋은 예
nohup python script.py > logs/train_$(date +%Y%m%d_%H%M%S).log 2>&1 &
```

### 2. 프로세스 ID 저장
```bash
nohup python script.py > logs/train.log 2>&1 &
echo $! > logs/train.pid

# 나중에 중단
kill $(cat logs/train.pid)
```

### 3. 실행 전 테스트
```bash
# dry-run 모드로 먼저 테스트 (1 epoch만)
python scripts/train.py --data ... --epochs 1

# 문제 없으면 전체 실행
nohup python scripts/train.py --data ... --epochs 150 > logs/train.log 2>&1 &
```

### 4. 디스크 공간 확인
```bash
# 사용 가능한 공간 확인
df -h

# 학습 결과 폴더 크기
du -sh runs/segment/silage_optimized
```

### 5. 정기적으로 모니터링
```bash
# 1시간마다 로그 확인 (cron 사용)
0 * * * * tail -50 ~/dbwjdakrso4235-sys/logs/train.log | mail -s "Training Log" your@email.com
```

---

## 🎯 빠른 참조

### Windows Git Bash (추천)
```bash
bash scripts/run_training_persistent.sh
tail -f logs/train_*.log
```

### Windows CMD
```cmd
scripts\run_training_persistent.bat
type logs\train_*.log
```

### Linux/Mac (nohup)
```bash
nohup python scripts/train.py --data ... > logs/train.log 2>&1 &
tail -f logs/train.log
```

### Linux/Mac (screen)
```bash
screen -S training
python scripts/train.py --data ...
# Ctrl+A, D
screen -r training
```

### Linux/Mac (tmux)
```bash
tmux new -s training
python scripts/train.py --data ...
# Ctrl+B, D
tmux attach -t training
```

---

## 📚 추가 자료

### 공식 문서
- [GNU screen manual](https://www.gnu.org/software/screen/manual/)
- [tmux documentation](https://github.com/tmux/tmux/wiki)
- [nohup man page](https://man7.org/linux/man-pages/man1/nohup.1.html)

### 유용한 링크
- [Screen Cheat Sheet](https://gist.github.com/jctosta/af918e1618682638aa82)
- [Tmux Cheat Sheet](https://tmuxcheatsheet.com/)
- [Background Processes in Linux](https://www.digitalocean.com/community/tutorials/how-to-use-bash-s-job-control-to-manage-foreground-and-background-processes)

---

**작성자**: Claude Sonnet 4.5
**최종 수정**: 2025-10-23
